import{t as _,a as u,c as vt}from"../chunks/OnU_l3An.js";import"../chunks/BsN24l2h.js";import{p as ft,u as K,v as bt,t as Q,o as t,a as xt,k as o,j as d,s as a,m as c,x as ht,r,f as _t,q as yt}from"../chunks/FB_gRupF.js";import{s as y,e as O}from"../chunks/BkxHr61Q.js";import{i as U}from"../chunks/BydVSvHb.js";import{e as gt,i as wt}from"../chunks/BWNo7gSO.js";import{r as Ct}from"../chunks/B5V6kkOL.js";import{b as St}from"../chunks/D4IycTRD.js";import{b as At}from"../chunks/DJRvsXZU.js";import{i as Dt}from"../chunks/0NZHIKlb.js";import{o as Lt,a as Pt}from"../chunks/SaxHpMRh.js";import{j as qt,q as V,c as W,d as S,w as B,o as Ft,u as Nt,e as X,g as kt,b as Tt}from"../chunks/CLR_ZPnl.js";var jt=_('<div class="text-center py-8 text-gray-400">Loading appointments...</div>'),It=_('<div class="text-center py-8 text-red-400"> </div>'),Rt=_('<tr><td colspan="4" class="text-center py-6 text-gray-500">No appointments found.</td></tr>'),zt=_('<tr class="border-t border-[#3a3a3a] hover:bg-[#262626] transition"><td class="px-6 py-4"> </td><td class="px-6 py-4"> </td><td class="px-6 py-4 capitalize"> </td><td class="px-6 py-4 flex gap-2"><button class="btn btn-xs btn-success">Complete</button> <button class="btn btn-xs btn-error">Cancel</button></td><td class="px-6 py-4"> </td></tr>'),Mt=_('<div class="overflow-x-auto mt-4 h-100 rounded-xl"><table class="table table-sm min-w-full overflow-y-scroll text-sm bg-[#2c2c2c] rounded-xl shadow-lg max-h-100"><thead class="text-left bg-[#1f1f1f] text-gray-400"><tr><th class="px-6 py-3">Patient Name</th><th class="px-6 py-3">Date & Time</th><th class="px-6 py-3">Status</th><th class="px-6 py-3">Actions</th><th class="px-6 py-3">Reason</th></tr></thead><tbody><!></tbody></table></div>'),Qt=_('<div class="p-6 text-white bg-[#181818] space-y-6"><h1 class="text-3xl font-bold">Appointment List</h1> <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4"><input type="text" placeholder="Search by patient name" class="bg-[#2c2c2c] text-white px-4 py-2 rounded-lg border border-gray-600 w-full md:w-1/2"> <select class="bg-[#2c2c2c] text-white px-4 py-2 rounded-lg border border-gray-600"><option>All</option><option>Pending</option><option>Completed</option><option>Cancelled</option></select></div> <!></div>');function Zt(Y,Z){ft(Z,!1);let A=c([]),D=c([]),g=c(""),v=c("All"),f=c(!0),b=c(null),L,x=c({}),P=c(),q=c("");async function $(){a(f,!0),a(b,null);const e=qt().currentUser;if(!e){a(b,"Not authenticated."),a(f,!1);return}try{const l=V(W(S,"appointments"),B("doctorId","==",e.uid));L=Ft(l,i=>{a(A,i.docs.map(p=>({id:p.id,...p.data()}))),a(f,!1)},i=>{a(b,"Failed to fetch appointments."),a(f,!1)})}catch{a(b,"Failed to fetch appointments."),a(f,!1)}}Lt($),Pt(()=>{L&&L()});async function E(e,l){a(x,{...t(x),[e]:!0});try{if(await Nt(X(S,"appointments",e),{status:l}),l==="Cancelled"){const i=V(W(S,"bills"),B("appointmentId","==",e),B("type","==","appointment")),m=(await kt(i)).docs.map(n=>Tt(X(S,"bills",n.id)));await Promise.all(m)}}catch(i){console.error("Failed to update status:",i),alert("Failed to update appointment status.")}finally{a(x,{...t(x),[e]:!1})}}K(()=>(t(P),t(g)),()=>{clearTimeout(t(P)),a(P,setTimeout(()=>{a(q,t(g))},300))}),K(()=>(t(A),t(q),t(v)),()=>{a(D,t(A).filter(e=>{var p;const l=(p=e.patientName)==null?void 0:p.toLowerCase().includes(t(q).toLowerCase()),i=t(v)==="All"||e.status===t(v);return l&&i}))}),bt(),Dt();var F=Qt(),N=d(o(F),2),k=o(N);Ct(k);var tt=d(k,2);Q(()=>{t(v),ht(()=>{})}),r(N);var et=d(N,2);{var at=e=>{var l=jt();u(e,l)},st=(e,l)=>{{var i=m=>{var n=It(),w=o(n,!0);r(n),Q(()=>y(w,t(b))),u(m,n)},p=m=>{var n=Mt(),w=o(n),G=d(o(w)),ot=o(G);{var rt=h=>{var C=Rt();u(h,C)},lt=h=>{var C=vt(),it=_t(C);gt(it,1,()=>t(D),wt,(nt,s)=>{var T=zt(),j=o(T),dt=o(j,!0);r(j);var I=d(j),ct=o(I,!0);r(I);var R=d(I),pt=o(R,!0);r(R);var z=d(R),M=o(z),H=d(M,2);r(z);var J=d(z),mt=o(J,!0);r(J),r(T),Q(ut=>{y(dt,t(s).patientName),y(ct,ut),y(pt,t(s).status),M.disabled=t(s).status!=="Pending"||t(x)[t(s).id],H.disabled=t(s).status!=="Pending"||t(x)[t(s).id],y(mt,t(s).reason||t(s).visitReason||"-")},[()=>t(s).date?new Date(t(s).date).toLocaleString():"-"],yt),O("click",M,()=>E(t(s).id,"Completed")),O("click",H,()=>E(t(s).id,"Cancelled")),u(nt,T)}),u(h,C)};U(ot,h=>{t(D).length===0?h(rt):h(lt,!1)})}r(G),r(w),r(n),u(m,n)};U(e,m=>{t(b)?m(i):m(p,!1)},l)}};U(et,e=>{t(f)?e(at):e(st,!1)})}r(F),St(k,()=>t(g),e=>a(g,e)),At(tt,()=>t(v),e=>a(v,e)),u(Y,F),xt()}export{Zt as component};
