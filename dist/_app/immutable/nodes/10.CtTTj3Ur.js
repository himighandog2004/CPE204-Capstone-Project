import{t as g,a as _,c as Ot}from"../chunks/OnU_l3An.js";import"../chunks/BsN24l2h.js";import{p as Tt,u as ft,v as Ut,f as tt,o as t,a as Et,k as s,s as c,m as b,j as i,r as a,w as Ft,t as j,q as Gt}from"../chunks/FB_gRupF.js";import{e as D,s as v}from"../chunks/BkxHr61Q.js";import{i as V}from"../chunks/BydVSvHb.js";import{e as mt,i as _t}from"../chunks/BWNo7gSO.js";import{r as Qt}from"../chunks/B5V6kkOL.js";import{s as Wt}from"../chunks/CjvYOB0v.js";import{b as Xt}from"../chunks/D4IycTRD.js";import{i as Ht}from"../chunks/0NZHIKlb.js";import{o as Jt,a as Kt}from"../chunks/SaxHpMRh.js";import{q as Rt,a as Yt,c as bt,d as xt,o as Zt,g as te}from"../chunks/CLR_ZPnl.js";var ee=g('<tr><td colspan="5" class="text-center">No bills found.</td></tr>'),ae=g('<tr><th></th><td> </td><td> </td><td><button class="btn btn-xs btn-info" type="button">View Details</button></td><td> </td></tr>'),se=g(', <span class="text-green-400"> </span>',1),re=g('<div class="mt-2 pt-2 border-t border-gray-700"><span class="text-gray-400">Test:</span> <span class="text-white"> </span></div>'),ie=g('<div class="mt-2 text-gray-400 text-sm"> </div>'),ne=g('<div class="bg-[#1f1f1f] rounded-lg p-4 space-y-2"><div class="flex justify-between items-start"><div class="space-y-1"><div class="text-lg font-medium"> </div> <div class="text-gray-400"> </div></div> <div class="text-right"><div class="text-lg font-semibold"> </div> <span> </span></div></div> <!> <!></div>'),oe=g('<div class="fixed inset-0 bg-black/50 flex items-center justify-center z-50"><div class="bg-[#2c2c2c] rounded-xl shadow-xl p-6 w-[90%] max-w-3xl max-h-[80vh] overflow-y-auto"><div class="flex justify-between items-center mb-6"><h3 class="text-2xl font-semibold text-white"> </h3> <button class="btn btn-soft btn-error">X</button></div> <div class="space-y-4"><div class="flex justify-between text-lg mb-4"><span class="text-gray-300">Total Amount: <span class="text-white font-semibold"> </span></span> <span class="text-gray-300">Status: <span class="text-yellow-400"> </span> <!></span></div> <div class="space-y-4"></div></div></div></div>'),le=g('<div class="flex flex-col h-full w-full"><div class="bg-[#102e50] rounded-t-xl p-4"><div class="flex justify-between"><h1 class="text-3xl text-white">Billing Overview</h1></div> <div class="flex justify-between items-center my-3"><input type="text" placeholder="Search name, email, or type..." class="input input-sm w-1/2"> <div class="space-x-2"><button class="btn btn-xs btn-success">Sort by Name</button> <button class="btn btn-xs btn-success">Sort by Amount</button> <button class="btn btn-xs btn-success">Sort by Status</button></div></div></div> <hr class="border-t-2 border-black"> <div class="bg-[#2c2c2c] rounded-b-xl p-5"><div class="overflow-x-auto overflow-y-scroll w-full h-100 bg-base-100 rounded-lg"><table class="table table-sm table-pin-rows"><thead><tr><th>#</th><th>Name</th><th>Amount</th><th>Breakdown</th><th>Status</th></tr></thead><tbody><!></tbody></table></div></div></div> <!>',1);function ye(gt,ht){Tt(ht,!1);const O=b(),T=b();let U=b([]),h=b({}),E,w=b(""),A=b(""),$=b(!0),F=b(!1),u=b(null);async function yt(){const e=await te(bt(xt,"users"));c(h,{}),e.forEach(r=>{const o=r.data();o.role==="Patient"&&Ft(h,t(h)[r.id]=o)})}Jt(async()=>{await yt();const e=Rt(bt(xt,"bills"),Yt("createdAt","desc"));E=Zt(e,r=>{c(U,r.docs.map(o=>({id:o.id,...o.data()})))})}),Kt(()=>{E&&E()});function G(e){t(A)===e?c($,!t($)):(c(A,e),c($,!0))}function wt(e){c(u,e),c(F,!0)}function At(){c(F,!1),c(u,null)}function z(e){return(e==null?void 0:e.toLowerCase().replace(/\b\w/g,r=>r.toUpperCase()))??""}ft(()=>(t(U),t(h),t(w),t(A),t($)),()=>{c(O,[...t(U)].filter(e=>{var n;const r=t(h)[e.patientId]||{};return`${r.name||e.patientName||""} ${r.surname||""}`.toLowerCase().includes(t(w).toLowerCase())||(((n=r.email)==null?void 0:n.toLowerCase())||"").includes(t(w).toLowerCase())||(e.type||"").toLowerCase().includes(t(w).toLowerCase())}).sort((e,r)=>{var l,C,p,x;if(!t(A))return((C=(l=r.createdAt)==null?void 0:l.toMillis)==null?void 0:C.call(l))-((x=(p=e.createdAt)==null?void 0:p.toMillis)==null?void 0:x.call(p));const o=e[t(A)]??"",n=r[t(A)]??"";return typeof o=="string"&&typeof n=="string"?t($)?o.localeCompare(n):n.localeCompare(o):e.createdAt&&r.createdAt?t($)?e.createdAt.toMillis()-r.createdAt.toMillis():r.createdAt.toMillis()-e.createdAt.toMillis():0}))}),ft(()=>(t(O),t(h)),()=>{c(T,(()=>{const e={};for(const r of t(O)){const o=t(h)[r.patientId]||{},n=`${z(o.name||r.patientName||"")} ${z(o.surname||"")}`.trim();e[n]||(e[n]={name:n,bills:[],total:0,pending:0,paid:0}),e[n].bills.push(r),e[n].total+=Number(r.amount)||0,r.status==="pending"&&e[n].pending++,r.status==="paid"&&e[n].paid++}return Object.values(e)})())}),Ut(),Ht();var et=le(),Q=tt(et),W=s(Q),at=i(s(W),2),X=s(at);Qt(X);var st=i(X,2),rt=s(st),it=i(rt,2),$t=i(it,2);a(st),a(at),a(W);var nt=i(W,4),ot=s(nt),lt=s(ot),dt=i(s(lt)),Ct=s(dt);{var St=e=>{var r=ee();_(e,r)},kt=e=>{var r=Ot(),o=tt(r);mt(o,1,()=>t(T),_t,(n,l,C)=>{var p=ae(),x=s(p);x.textContent=C+1;var y=i(x),L=s(y,!0);a(y);var S=i(y),H=s(S);a(S);var k=i(S),B=s(k);a(k);var I=i(k),J=s(I);a(I),a(p),j(()=>{v(L,t(l).name),v(H,`₱${t(l).total??""}`),v(J,`${t(l).pending??""} Pending${t(l).paid?`, ${t(l).paid} Paid`:""}`)}),D("click",B,()=>wt(t(l))),_(n,p)}),_(e,r)};V(Ct,e=>{t(T).length===0?e(St):e(kt,!1)})}a(dt),a(lt),a(ot),a(nt),a(Q);var Mt=i(Q,2);{var Nt=e=>{var r=oe(),o=s(r),n=s(o),l=s(n),C=s(l);a(l);var p=i(l,2);a(n);var x=i(n,2),y=s(x),L=s(y),S=i(s(L)),H=s(S);a(S),a(L);var k=i(L,2),B=i(s(k)),I=s(B);a(B);var J=i(B,2);{var jt=P=>{var d=se(),M=i(tt(d)),q=s(M);a(M),j(()=>v(q,`${t(u).paid??""} Paid`)),_(P,d)};V(J,P=>{t(u).paid&&P(jt)})}a(k),a(y);var vt=i(y,2);mt(vt,5,()=>t(u).bills,_t,(P,d)=>{var M=ne(),q=s(M),K=s(q),R=s(K),Lt=s(R,!0);a(R);var ct=i(R,2),Bt=s(ct,!0);a(ct),a(K);var pt=i(K,2),Y=s(pt),Pt=s(Y);a(Y);var Z=i(Y,2),qt=s(Z,!0);a(Z),a(pt),a(q);var ut=i(q,2);{var Dt=f=>{var m=re(),N=i(s(m),2),It=s(N,!0);a(N),a(m),j(()=>v(It,t(d).testName||t(d).test)),_(f,m)};V(ut,f=>{t(d).type==="labtest"&&f(Dt)})}var Vt=i(ut,2);{var zt=f=>{var m=ie(),N=s(m,!0);a(m),j(()=>v(N,t(d).description)),_(f,m)};V(Vt,f=>{t(d).description&&f(zt)})}a(M),j((f,m,N)=>{v(Lt,f),v(Bt,m),v(Pt,`₱${t(d).amount??""}`),Wt(Z,1,`px-2 py-1 rounded-full text-xs font-medium
                    ${t(d).status==="pending"?"bg-yellow-500/20 text-yellow-400":"bg-green-500/20 text-green-400"}`),v(qt,N)},[()=>z(t(d).type),()=>t(d).createdAt?new Date(t(d).createdAt.seconds*1e3).toLocaleString("en-US",{month:"2-digit",day:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):"-",()=>z(t(d).status)],Gt),_(P,M)}),a(vt),a(x),a(o),a(r),j(()=>{v(C,`Bill Details - ${t(u).name??""}`),v(H,`₱${t(u).total??""}`),v(I,`${t(u).pending??""} Pending`)}),D("click",p,At),_(e,r)};V(Mt,e=>{t(F)&&t(u)&&e(Nt)})}Xt(X,()=>t(w),e=>c(w,e)),D("click",rt,()=>G("patientName")),D("click",it,()=>G("amount")),D("click",$t,()=>G("status")),_(gt,et),Et()}export{ye as component};
