import{t as A,a as f,b as te}from"../chunks/OnU_l3An.js";import"../chunks/BsN24l2h.js";import{p as Se,u as Mt,v as Te,o as t,a as Ee,j as r,s as o,m as w,k as a,r as e,t as R,q as Lt,f as ee,w as ft}from"../chunks/FB_gRupF.js";import{s as v,e as X,r as Pe}from"../chunks/BkxHr61Q.js";import{i as B}from"../chunks/BydVSvHb.js";import{e as qt,i as Ot}from"../chunks/BWNo7gSO.js";import{r as ct}from"../chunks/B5V6kkOL.js";import{s as ae}from"../chunks/CjvYOB0v.js";import{b as rt}from"../chunks/D4IycTRD.js";import{i as Re}from"../chunks/0NZHIKlb.js";import{o as re,a as Be}from"../chunks/SaxHpMRh.js";import{j as ie,i as oe,c as gt,d as V,o as $t,q as se,w as jt,g as Fe,f as le,e as xt,k as Ce,s as de,h as Le,u as qe}from"../chunks/CLR_ZPnl.js";var Oe=A('<div class="text-center py-4">Loading...</div>'),$e=A('<div class="text-red-400 py-4"> </div>'),je=A('<li><button> <div class="text-sm text-gray-400"> </div></button></li>'),ze=A('<ul class="space-y-2"></ul>'),Qe=A('<div class="grid grid-cols-2 gap-4"><div><h2 class="block text-base font-bold">Age</h2> <p class="text-base"> </p></div> <div><h2 class="text-base font-bold">Sex</h2> <p class="text-base"> </p></div> <div><label for="bloodType" class="block text-sm text-gray-400 mb-1">Blood Type</label> <input id="bloodType" list="blood" type="text" class="input bg-[#181818] w-full p-2 rounded border"> <datalist id="blood"><option>A+</option><option>A-</option><option>B+</option><option>B-</option><option>AB+</option><option>AB-</option><option>O+</option><option>O-</option></datalist></div> <div><label for="weight" class="block text-sm text-gray-400 mb-1">Weight (kg)</label> <input id="weight" type="number" class="input bg-[#181818] w-full p-2 rounded border"></div> <div><label for="height" class="block text-sm text-gray-400 mb-1">Height (cm)</label> <input id="height" type="number" class="input bg-[#181818] w-full p-2 rounded border"></div> <div><label for="allergies" class="block text-sm text-gray-400 mb-1">Allergies</label> <input id="allergies" type="text" class="input bg-[#181818] w-full p-2 rounded border"></div></div> <div><label for="medicalNotes" class="block text-sm text-gray-400 mb-1 mt-4">Medical Notes</label> <textarea id="medicalNotes" class="input bg-[#181818] w-full p-2 rounded border h-32"></textarea></div>',1),Ve=A('<div class="grid grid-cols-2 gap-4"><div><h2 class="block text-base text-gray-400 font-bold">Age</h2> <p class="text-base mt-1"> </p></div> <div><h2 class="text-base text-gray-400 font-bold">Sex</h2> <p class="text-base mt-1"> </p></div> <div><h2 class="text-base text-gray-400 font-bold">Blood Type</h2> <p class="text-base mt-1"> </p></div> <div><h2 class="text-base text-gray-400 font-bold">Weight (kg)</h2> <p class="text-base mt-1"> </p></div> <div><h2 class="text-base text-gray-400 font-bold">Height (cm)</h2> <p class="text-base mt-1"> </p></div> <div><h2 class="text-base text-gray-400 font-bold">Allergies</h2> <p class="text-base mt-1"> </p></div></div> <div><h2 class="text-base text-gray-400 font-bold">Medical Notes</h2> <p class="text-base mt-1"> </p></div>',1),He=A('<li><button class="justify-between"><div><span class="font-semibold"> </span></div></button></li>'),Ue=A('<ul class="menu bg-base-300 rounded-box max-h-40 menu-horizontal overflow-y-auto border border-base-200"></ul>'),We=A('<div class="alert bg-base-300 text-white border border-base-200"><div><span class="font-bold"> </span><br> <span class="text-sm text-gray-400"> </span></div></div>'),Ge=A('<div class="text-sm text-gray-400 text-center"> </div>'),Je=A('<div class="text-center text-gray-400">Loading prescriptions...</div>'),Ke=A('<div class="text-error"> </div>'),Xe=A('<div class="text-gray-500">No prescriptions yet</div>'),Ye=A('<tr><td> </td><td class="text-center"> </td><td> </td></tr>'),Ze=A('<div class="overflow-x-auto"><table class="table table-zebra table-sm text-sm"><thead><tr><th><button class="btn btn-ghost btn-xs">Medicine <!></button></th><th>Qty</th><th><button class="btn btn-ghost btn-xs">Date <!></button></th></tr></thead><tbody></tbody></table></div>'),ta=A('<div class="flex flex-col lg:flex-row gap-6"><div class="space-y-4 w-[60%]"><div class="flex justify-between items-center"><h1 class="text-2xl font-bold"> </h1> <button> </button></div> <div class="space-y-4"><!></div></div> <div class="w-[40%] bg-base-200 p-6 rounded-xl border border-base-300 shadow space-y-5 h-135 overflow-y-scroll"><h2 class="text-2xl font-bold text-white">Prescribe Medicine</h2> <div class="form-control"><label class="label text-sm text-gray-400">Search Medicine</label> <input type="text" placeholder="Enter medicine name..." class="input input-bordered w-full bg-base-100 text-white"></div> <!> <!> <div class="form-control"><label class="label text-sm text-gray-400">Quantity</label> <div class="flex items-center gap-3"><button class="btn btn-sm btn-outline">âˆ’</button> <span class="text-lg"> </span> <button class="btn btn-sm btn-outline">+</button></div></div> <!> <button class="btn btn-primary w-full mt-2">âž• Add Prescription</button> <div class="mt-6"><h3 class="text-lg font-bold text-white mb-2">ðŸ“‹ Current Prescriptions</h3> <!></div></div></div>'),ea=A('<div class="text-center text-gray-400">Select a patient from the sidebar to view their details</div>'),aa=A('<div class="h-144 rounded-xl flex bg-[#181818] text-white"><aside class="w-64 bg-[#1f1f1f] p-4 overflow-y-auto border-r border-[#333] rounded-l-xl"><h2 class="text-lg font-semibold mb-4">My Patients</h2> <div class="form-control mb-4"><label class="label text-sm text-gray-400">Search Patient</label> <input type="text" placeholder="Enter patient name..." class="input input-bordered w-full bg-base-100 text-white"></div> <!></aside> <main class="flex-1 p-6 overflow-y-hidden bg-[#2c2c2c] rounded-r-xl overflow-x-hidden"><!></main></div>');function ma(ne,ce){Se(ce,!1);const ht=w(),zt=w(),Qt=w();let H="",vt=w([]),b=w(null),ut=w(!0),T=w(""),yt=w("");re(()=>{const i=ie(),l=oe(i,async c=>{try{o(ut,!0),c?(H=c.uid,await St()):o(T,"Please log in to access this page")}catch(d){console.error("Error in auth change:",d),o(T,"Failed to load data")}finally{o(ut,!1)}}),g=gt(V,"medicines"),u=$t(g,c=>{try{o(wt,c.docs.map(d=>({id:d.id,...d.data()})))}catch(d){console.error("Error loading medicines:",d),o(T,"Failed to load medicines")}});return()=>{l(),u()}});let it=w(!1),U=w({bloodType:"",weight:0,height:0,allergies:"",medicalNotes:""}),wt=w([]),_=w(null),h=w(0),At=w([]),Y=w(""),Z=w("createdAt"),$=w(!1),pt,bt;async function St(){try{if(!H)throw new Error("No doctor ID available");const i=gt(V,"appointments"),l=se(i,jt("doctorId","==",H)),g=await Fe(l),u=[...new Set(g.docs.map(n=>n.data().patientId).filter(n=>n&&n.trim()!==""))];if(u.length===0){o(vt,[]);return}const c=gt(V,"users"),d=[];for(const n of u)try{const M=await le(xt(c,n));M.exists()&&d.push(M)}catch(M){console.error(`Error fetching patient ${n}:`,M)}o(vt,d.map(n=>({id:n.id,name:n.data().name||"",surname:n.data().surname||"",age:n.data().age,sex:n.data().sex,bloodType:n.data().bloodType,weight:n.data().weight,height:n.data().height,allergies:n.data().allergies,medicalNotes:n.data().medicalNotes}))),console.log("Doctor ID:",H),console.log("Found patient IDs:",u),console.log("Patients:",t(vt))}catch(i){throw console.error("Error loading data:",i),o(T,"Failed to load patient data"),i}finally{o(ut,!1)}}re(async()=>{try{const i=ie();i.currentUser?(H=i.currentUser.uid,await St()):oe(i,async l=>{l&&(H=l.uid,await St())})}catch(i){console.error("Error in onMount:",i),o(T,"Failed to initialize component")}});async function ve(i){if(!(i!=null&&i.id)){console.error("Invalid patient selected");return}o(b,i),pt&&pt(),bt&&bt();try{const l=xt(V,"record",i.id);pt=$t(l,u=>{u.exists()?o(U,{...t(U),...u.data()}):o(U,{bloodType:"",weight:0,height:0,allergies:"",medicalNotes:""})});const g=se(gt(V,"bills"),jt("patientId","==",i.id),jt("type","==","prescription"));bt=$t(g,u=>{o(At,u.docs.map(c=>{var n;const d=c.data();return{id:c.id,type:d.type||"",docId:d.docId||"",patientId:d.patientId||"",medicineId:d.medicineId||"",medicineName:(n=t(wt).find(M=>M.id===d.medicineId))==null?void 0:n.name,itemAmount:d.itemAmount||0,amount:d.amount||0,createdAt:d.createdAt,status:d.status||"pending"}}))})}catch(l){console.error("Error setting up patient listeners:",l),o(T,"Failed to load patient details")}}async function ue(){if(t(b))try{const i=xt(V,"record",t(b).id);await Ce(i,{...t(m),updatedAt:de()},{merge:!0}),o(it,!1)}catch(i){console.error("Error saving medical record:",i),o(T,"Failed to save medical record")}}function pe(){o(it,!0)}async function be(){if(!(!t(b)||!t(_)||t(h)<=0)){if(t(h)>t(_).stock){o(T,"Not enough medicine in stock");return}try{const i={type:"prescription",docId:H,doctorName:"",patientName:`${t(b).name} ${t(b).surname}`,patientId:t(b).id,medicineId:t(_).id,medicineName:t(_).name,description:`${t(_).name} - ${t(h)} units`,itemAmount:t(h),amount:t(h)*t(_).price,status:"pending",createdAt:de(),prescribedDate:new Date().toISOString(),expiryDate:new Date(Date.now()+6048e5).toISOString()},l=await le(xt(V,"users",H));if(l.exists()){const c=l.data();i.doctorName=`Dr. ${c.name} ${c.surname}`}const g=await Le(gt(V,"bills"),i),u=xt(V,"medicines",t(_).id);await qe(u,{stock:t(_).stock-t(h)}),o(_,null),o(h,0),o(Y,"")}catch(i){throw console.error("Error adding prescription:",i),o(T,"Failed to add prescription"),i}}}function Vt(i){t(Z)===i?o($,!t($)):(o(Z,i),o($,!0))}let m=w({age:"",sex:"",bloodType:"",weight:0,height:0,allergies:"",medicalNotes:""});Be(()=>{pt&&pt(),bt&&bt()}),Mt(()=>(t(wt),t(Y)),()=>{o(ht,t(wt).filter(i=>{var l,g;return(g=i==null?void 0:i.name)==null?void 0:g.toLowerCase().includes(((l=t(Y))==null?void 0:l.toLowerCase())??"")}))}),Mt(()=>(t(vt),t(yt)),()=>{o(zt,t(vt).filter(i=>{const l=t(yt).toLowerCase();return`${i.name} ${i.surname}`.toLowerCase().includes(l)}))}),Mt(()=>(t(At),t(Z),t($)),()=>{o(Qt,[...t(At)].sort((i,l)=>{if(t(Z)==="createdAt")return t($)?i.createdAt.toMillis()-l.createdAt.toMillis():l.createdAt.toMillis()-i.createdAt.toMillis();const g=d=>{switch(t(Z)){case"medicineName":return d.medicineName||"";case"amount":return d.amount;default:return""}},u=g(i),c=g(l);return typeof u=="string"&&typeof c=="string"?t($)?u.localeCompare(c):c.localeCompare(u):t($)?Number(u)-Number(c):Number(c)-Number(u)}))}),Mt(()=>t(b),()=>{t(b)&&o(m,{patientId:t(b).id,name:`${t(b).name} ${t(b).surname}`,age:t(b).age||"",sex:t(b).sex||"",bloodType:t(b).bloodType||"",weight:t(b).weight||0,height:t(b).height||0,allergies:t(b).allergies||"",medicalNotes:t(b).medicalNotes||""})}),Te(),Re();var Tt=aa(),Et=a(Tt),Pt=r(a(Et),2),Ht=r(a(Pt),2);ct(Ht),e(Pt);var me=r(Pt,2);{var _e=i=>{var l=Oe();f(i,l)},fe=(i,l)=>{{var g=c=>{var d=$e(),n=a(d,!0);e(d),R(()=>v(n,t(T))),f(c,d)},u=c=>{var d=ze();qt(d,5,()=>t(zt),Ot,(n,M)=>{var ot=je(),st=a(ot);let Nt;var Dt=a(st),mt=r(Dt),_t=a(mt);e(mt),e(st),e(ot),R(tt=>{Nt=ae(st,1,"w-full text-left p-2 rounded-lg hover:bg-[#2c2c2c] transition font-medium",null,Nt,tt),v(Dt,`${t(M).name??""} ${t(M).surname??""} `),v(_t,`${t(M).age||"-"} y/o, ${t(M).sex||"-"}`)},[()=>{var tt;return{"bg-[#2c2c2c]":((tt=t(b))==null?void 0:tt.id)===t(M).id}}],Lt),X("click",st,()=>ve(t(M))),f(n,ot)}),e(d),f(c,d)};B(i,c=>{t(T)?c(g):c(u,!1)},l)}};B(me,i=>{t(ut)?i(_e):i(fe,!1)})}e(Et);var Ut=r(Et,2),ge=a(Ut);{var xe=i=>{var l=ta(),g=a(l),u=a(g),c=a(u),d=a(c);e(c);var n=r(c,2),M=a(n,!0);e(n),e(u);var ot=r(u,2),st=a(ot);{var Nt=s=>{var p=Qe(),N=ee(p),x=a(N),y=r(a(x),2),D=a(y,!0);e(y),e(x);var k=r(x,2),C=r(a(k),2),P=a(C,!0);e(C),e(k);var E=r(k,2),j=r(a(E),2);ct(j);var W=r(j,2),L=a(W);L.value=L.__value="A+";var q=r(L);q.value=q.__value="A-";var z=r(q);z.value=z.__value="B+";var Q=r(z);Q.value=Q.__value="B-";var G=r(Q);G.value=G.__value="AB+";var J=r(G);J.value=J.__value="AB-";var O=r(J);O.value=O.__value="O+";var et=r(O);et.value=et.__value="O-",e(W),e(E);var at=r(E,2),K=r(a(at),2);ct(K),e(at);var I=r(at,2),S=r(a(I),2);ct(S),e(I);var lt=r(I,2),dt=r(a(lt),2);ct(dt),e(lt),e(N);var kt=r(N,2),nt=r(a(kt),2);Pe(nt),e(kt),R(()=>{v(D,t(m).age),v(P,t(m).sex)}),rt(j,()=>t(m).bloodType,F=>ft(m,t(m).bloodType=F)),rt(K,()=>t(m).weight,F=>ft(m,t(m).weight=F)),rt(S,()=>t(m).height,F=>ft(m,t(m).height=F)),rt(dt,()=>t(m).allergies,F=>ft(m,t(m).allergies=F)),rt(nt,()=>t(m).medicalNotes,F=>ft(m,t(m).medicalNotes=F)),f(s,p)},Dt=s=>{var p=Ve(),N=ee(p),x=a(N),y=r(a(x),2),D=a(y,!0);e(y),e(x);var k=r(x,2),C=r(a(k),2),P=a(C,!0);e(C),e(k);var E=r(k,2),j=r(a(E),2),W=a(j,!0);e(j),e(E);var L=r(E,2),q=r(a(L),2),z=a(q,!0);e(q),e(L);var Q=r(L,2),G=r(a(Q),2),J=a(G,!0);e(G),e(Q);var O=r(Q,2),et=r(a(O),2),at=a(et,!0);e(et),e(O),e(N);var K=r(N,2),I=r(a(K),2),S=a(I,!0);e(I),e(K),R(()=>{v(D,t(m).age),v(P,t(m).sex),v(W,t(U).bloodType),v(z,t(U).weight),v(J,t(U).height),v(at,t(U).allergies),v(S,t(U).medicalNotes)}),f(s,p)};B(st,s=>{t(it)?s(Nt):s(Dt,!1)})}e(ot),e(g);var mt=r(g,2),_t=r(a(mt),2),tt=r(a(_t),2);ct(tt),e(_t);var Wt=r(_t,2);{var ye=s=>{var p=Ue();qt(p,5,()=>t(ht),Ot,(N,x)=>{var y=He(),D=a(y),k=a(D),C=a(k),P=a(C,!0);e(C),e(k),e(D),e(y),R(()=>v(P,t(x).name)),X("click",D,()=>{o(_,t(x)),o(Y,t(x).name),o(ht,[])}),f(N,y)}),e(p),f(s,p)};B(Wt,s=>{t(Y)&&t(ht).length>0&&s(ye)})}var Gt=r(Wt,2);{var we=s=>{var p=We(),N=a(p),x=a(N),y=a(x,!0);e(x);var D=r(x,3),k=a(D);e(D),e(N),e(p),R(()=>{v(y,t(_).name),v(k,`Item ID: ${t(_).id??""}`)}),f(s,p)};B(Gt,s=>{t(_)&&s(we)})}var Rt=r(Gt,2),Jt=r(a(Rt),2),Bt=a(Jt),Ft=r(Bt,2),Ae=a(Ft,!0);e(Ft);var Kt=r(Ft,2);e(Jt),e(Rt);var Xt=r(Rt,2);{var Ne=s=>{var p=Ge(),N=a(p);e(p),R(x=>v(N,`ðŸ’µ Total: â‚±${x??""}`),[()=>(t(h)*t(_).price).toFixed(2)],Lt),f(s,p)};B(Xt,s=>{t(_)&&t(h)>0&&s(Ne)})}var Ct=r(Xt,2),Yt=r(Ct,2),De=r(a(Yt),2);{var ke=s=>{var p=Je();f(s,p)},Ie=(s,p)=>{{var N=y=>{var D=Ke(),k=a(D,!0);e(D),R(()=>v(k,t(T))),f(y,D)},x=(y,D)=>{{var k=P=>{var E=Xe();f(P,E)},C=P=>{var E=Ze(),j=a(E),W=a(j),L=a(W),q=a(L),z=a(q),Q=r(a(z));{var G=I=>{var S=te();R(()=>v(S,t($)?"â†‘":"â†“")),f(I,S)};B(Q,I=>{t(Z)==="medicineName"&&I(G)})}e(z),e(q);var J=r(q,2),O=a(J),et=r(a(O));{var at=I=>{var S=te();R(()=>v(S,t($)?"â†‘":"â†“")),f(I,S)};B(et,I=>{t(Z)==="createdAt"&&I(at)})}e(O),e(J),e(L),e(W);var K=r(W);qt(K,5,()=>t(Qt),Ot,(I,S)=>{var lt=Ye(),dt=a(lt),kt=a(dt,!0);e(dt);var nt=r(dt),F=a(nt,!0);e(nt);var Zt=r(nt),Me=a(Zt,!0);e(Zt),e(lt),R(It=>{v(kt,t(S).medicineName),v(F,t(S).itemAmount),v(Me,It)},[()=>{var It;return((It=t(S).createdAt)==null?void 0:It.toDate().toLocaleDateString())||"-"}],Lt),f(I,lt)}),e(K),e(j),e(E),X("click",z,()=>Vt("medicineName")),X("click",O,()=>Vt("createdAt")),f(P,E)};B(y,P=>{t(At).length===0?P(k):P(C,!1)},D)}};B(s,y=>{t(T)?y(N):y(x,!1)},p)}};B(De,s=>{t(ut)?s(ke):s(Ie,!1)})}e(Yt),e(mt),e(l),R(()=>{var s;v(d,`${t(b).name??""}'s Medical Record`),ae(n,1,`px-4 py-2 text-white text-sm font-semibold rounded-lg btn-soft 
                ${t(it)?"btn btn-soft btn-success":"btn btn-soft btn-info"}`),v(M,t(it)?"Save":"Edit"),Bt.disabled=t(h)<=0,v(Ae,t(h)),Kt.disabled=!t(_)||t(h)>=t(_).stock,Ct.disabled=!t(_)||t(h)<=0||t(h)>(((s=t(_))==null?void 0:s.stock)||0)}),X("click",n,function(...s){var p;(p=t(it)?ue:pe)==null||p.apply(this,s)}),rt(tt,()=>t(Y),s=>o(Y,s)),X("click",Bt,()=>o(h,Math.max(0,t(h)-1))),X("click",Kt,()=>{var s;return o(h,Math.min(((s=t(_))==null?void 0:s.stock)||0,t(h)+1))}),X("click",Ct,be),f(i,l)},he=i=>{var l=ea();f(i,l)};B(ge,i=>{t(b)?i(xe):i(he,!1)})}e(Ut),e(Tt),rt(Ht,()=>t(yt),i=>o(yt,i)),f(ne,Tt),Ee()}export{ma as component};
