import{t as u,a as p}from"../chunks/OnU_l3An.js";import"../chunks/BsN24l2h.js";import{p as it,f as dt,a as ct,s as n,m as D,j as l,k as e,o as a,r as s,t as Q,l as pt,q as H}from"../chunks/FB_gRupF.js";import{s as m,e as R}from"../chunks/BkxHr61Q.js";import{i as A}from"../chunks/BydVSvHb.js";import{e as ut,i as vt}from"../chunks/BWNo7gSO.js";import{s as ft}from"../chunks/CjvYOB0v.js";import{i as bt}from"../chunks/0NZHIKlb.js";import{o as mt,a as gt}from"../chunks/SaxHpMRh.js";import{j as xt,i as yt,q as ht,c as _t,d as J,w as wt,o as Dt,e as At,u as Pt}from"../chunks/CLR_ZPnl.js";var jt=u('<p class="text-red-400"> </p>'),kt=u('<p class="text-gray-400">Loading bills...</p>'),St=u('<button class="px-3 py-1 btn btn-soft btn-info">Pay Now</button>'),Ct=u('<span class="text-gray-500">-</span>'),Mt=u('<tr class="border-b border-[#3a3a3a] hover:bg-[#1f1f1f]"><td class="px-4 py-3"> </td><td class="px-4 py-3"> </td><td class="px-4 py-3"> </td><td class="px-4 py-3"><span> </span></td><td class="px-4 py-3"><!></td></tr>'),qt=u('<div class="overflow-x-auto"><table class="min-w-full text-left text-sm"><thead class="bg-[#181818] text-gray-300 uppercase text-xs"><tr><th class="px-4 py-3">Date</th><th class="px-4 py-3">Description</th><th class="px-4 py-3">Amount</th><th class="px-4 py-3">Status</th><th class="px-4 py-3">Actions</th></tr></thead><tbody></tbody></table></div>'),Bt=u('<p class="text-gray-400">You have no bills yet.</p>'),Et=u('<div class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50"><div class="bg-[#2c2c2c] text-white rounded-xl p-6 w-[90%] max-w-md shadow-lg"><h3 class="text-xl font-semibold mb-4">Confirm Payment</h3> <p class="mb-2">Are you sure you want to pay <strong> </strong> for the bill dated <strong> </strong>?</p> <p class="text-sm text-gray-400 mb-4"><strong>Please pay by scanning the QR Code below</strong></p> <div class="flex items-center justify-center"><img src="/gcash.jpg" alt="gcash" class="mb-3 h-100 w-70"></div> <div class="flex justify-end gap-3"><button class="btn btn-soft btn-error">Cancel</button> <button class="btn btn-soft btn-success">Confirm</button></div></div></div>'),Ft=u('<div class="p-6 bg-[#2c2c2c] rounded-2xl shadow-md text-white"><h2 class="text-2xl font-bold mb-4">My Bills</h2> <!> <!></div> <!>',1);function Jt(K,O){it(O,!1);let k=D([]),y=D(!0),g=D(null),S=D(!1),f=D(null),C;function z(t){return t?(t.toDate?t.toDate():new Date(t)).toLocaleDateString("en-US",{month:"2-digit",day:"2-digit",year:"numeric"}):"-"}function I(t){return`₱${t.toLocaleString()}`}function T(t){n(f,t),n(S,!0)}function N(){n(S,!1),n(f,null)}async function V(){if(a(f))try{const t=At(J,"bills",a(f).id);await Pt(t,{status:"paid",paidAt:new Date}),N()}catch(t){console.error("Error updating payment:",t),n(g,"Failed to process payment")}}mt(()=>{const t=xt();yt(t,r=>{if(!r){n(g,"Please login to view your bills"),n(y,!1);return}try{const d=ht(_t(J,"bills"),wt("patientId","==",r.uid));C=Dt(d,c=>{n(k,c.docs.map(o=>({id:o.id,...o.data()}))),n(y,!1)},c=>{console.error("Error fetching bills:",c),n(g,"Failed to load bills"),n(y,!1)})}catch(d){console.error("Error in bills setup:",d),n(g,"Failed to setup bills listener"),n(y,!1)}})}),gt(()=>{C&&C()}),bt();var U=Ft(),M=dt(U),Y=l(e(M),2);{var W=t=>{var r=jt(),d=e(r,!0);s(r),Q(()=>m(d,a(g))),p(t,r)};A(Y,t=>{a(g)&&t(W)})}var X=l(Y,2);{var Z=t=>{var r=kt();p(t,r)},$=(t,r)=>{{var d=o=>{var b=qt(),h=e(b),P=l(e(h));ut(P,5,()=>a(k),vt,(j,i)=>{var _=Mt(),w=e(_),q=e(w,!0);s(w);var B=l(w),st=e(B,!0);s(B);var E=l(B),et=e(E,!0);s(E);var F=l(E),L=e(F),rt=e(L,!0);s(L),s(F);var G=l(F),ot=e(G);{var nt=v=>{var x=St();R("click",x,()=>T(a(i))),p(v,x)},lt=v=>{var x=Ct();p(v,x)};A(ot,v=>{a(i).status==="pending"?v(nt):v(lt,!1)})}s(G),s(_),Q((v,x)=>{m(q,v),m(st,a(i).description||"-"),m(et,x),ft(L,1,`px-2 py-1 rounded-full text-xs font-semibold
                  ${a(i).status==="paid"?"badge badge-success":""}
                  ${a(i).status==="pending"?"badge badge-warning":""}`),m(rt,a(i).status==="paid"?"✓ Paid":a(i).status==="pending"?"⏳ Pending":" - ")},[()=>z(a(i).date),()=>I(a(i).amount)],H),p(j,_)}),s(P),s(h),s(b),p(o,b)},c=o=>{var b=Bt();p(o,b)};A(t,o=>{a(k).length>0?o(d):o(c,!1)},r)}};A(X,t=>{a(y)?t(Z):t($,!1)})}s(M);var tt=l(M,2);{var at=t=>{var r=Et(),d=e(r),c=l(e(d),2),o=l(e(c)),b=e(o,!0);s(o);var h=l(o,2),P=e(h,!0);s(h),pt(),s(c);var j=l(c,6),i=e(j),_=l(i,2);s(j),s(d),s(r),Q((w,q)=>{m(b,w),m(P,q)},[()=>I(a(f).amount),()=>z(a(f).date)],H),R("click",i,N),R("click",_,V),p(t,r)};A(tt,t=>{a(S)&&a(f)&&t(at)})}p(K,U),ct()}export{Jt as component};
