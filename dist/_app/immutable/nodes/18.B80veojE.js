import{t as f,a as p,b as ue,c as He}from"../chunks/OnU_l3An.js";import"../chunks/BsN24l2h.js";import{ag as Ue,p as Be,i as Ve,u as ze,v as Ge,f as Ut,t as D,a as Ye,s as n,m,j as o,k as s,o as t,r,l as pe,q as ve,x as Bt}from"../chunks/FB_gRupF.js";import{e as F,s as x}from"../chunks/BkxHr61Q.js";import{i as A}from"../chunks/BydVSvHb.js";import{e as X,i as Vt}from"../chunks/BWNo7gSO.js";import{r as fe,s as Je}from"../chunks/B5V6kkOL.js";import{s as Ke}from"../chunks/CjvYOB0v.js";import{b as me}from"../chunks/D4IycTRD.js";import{b as zt}from"../chunks/DJRvsXZU.js";import{p as We,s as Xe,a as Ze}from"../chunks/BDD76Zze.js";import{i as ta}from"../chunks/0NZHIKlb.js";import{o as ea,a as aa}from"../chunks/SaxHpMRh.js";import{e as oa,d as C,f as ra,q as z,w as G,c as M,o as Z,j as sa,i as ia,g as na,s as be,h as _e}from"../chunks/CLR_ZPnl.js";function la(it,Y){var b;var R=(b=it.$$events)==null?void 0:b[Y.type],J=Ue(R)?R.slice():R==null?[]:[R];for(var q of J)q.call(this,Y)}var da=f("<li> </li>"),ca=f('<ul class="menu text-base"></ul>'),ua=f('<p class="text-gray-500">No doctors assigned yet.</p>'),pa=f('<p class="text-4xl font-bold"> </p>'),va=f('<p class="text-gray-500">No upcoming appointments.</p>'),fa=f('<tr><td colspan="3" class="text-center text-gray-400">No bills found.</td></tr>'),ma=f("<tr><td> </td><td> </td><td> </td></tr>"),ba=f('<tr><td colspan="5" class="text-center text-gray-400">No pending or completed appointments found.</td></tr>'),_a=f("<tr><td> </td><td> </td><td> </td><td> </td><td> </td></tr>"),ga=f('<div role="alert"> </div>'),xa=f("<option disabled>Loading specialties...</option>"),ha=f("<option disabled>No specialties available.</option>"),ya=f("<option> </option>"),wa=f("<option> </option>"),Da=f("<option disabled>No doctors for this specialty.</option>"),ka=f("<!> <!>",1),Aa=f('<div class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-80 p-4 transition-opacity duration-300 ease-in-out"><div class="bg-[#2c2c2c] p-6 sm:p-8 rounded-xl shadow-2xl max-w-lg w-full text-gray-100 transform transition-all duration-300 ease-in-out scale-100" role="dialog" aria-modal="true" aria-labelledby="modal-title"><div class="flex justify-between items-center mb-6"><h2 id="modal-title" class="text-2xl font-semibold text-white">New Appointment</h2> <button class="text-gray-400 hover:text-white text-3xl leading-none focus:outline-none">&times;</button></div> <!> <form><div class="space-y-5"><div><label for="specialty" class="block text-sm font-medium text-gray-300 mb-1">Specialty <span class="text-red-400">*</span></label> <select id="specialty" class="w-full bg-[#3b3b3b] text-gray-100 p-2.5 border border-gray-600 rounded-md focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-colors" required><option>Select a specialty</option><!></select></div> <div><label for="doctor" class="block text-sm font-medium text-gray-300 mb-1">Doctor <span class="text-red-400">*</span></label> <select id="doctor" class="w-full bg-[#3b3b3b] text-gray-100 p-2.5 border border-gray-600 rounded-md focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-colors" required><option disabled>Select a doctor</option><!></select></div> <div class="grid grid-cols-1 sm:grid-cols-2 gap-5"><div><label for="appointmentDate" class="block text-sm font-medium text-gray-300 mb-1">Date <span class="text-red-400">*</span></label> <input type="date" id="appointmentDate" class="w-full bg-[#3b3b3b] text-gray-100 p-2.5 border border-gray-600 rounded-md focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-colors" required></div> <div><label for="appointmentTime" class="block text-sm font-medium text-gray-300 mb-1">Time <span class="text-red-400">*</span></label> <input type="time" id="appointmentTime" class="w-full bg-[#3b3b3b] text-gray-100 p-2.5 border border-gray-600 rounded-md focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-colors" required></div></div> <div><label for="reason" class="block text-sm font-medium text-gray-300 mb-1">Reason for Appointment <span class="text-red-400">*</span></label> <select id="reason" class="w-full bg-[#3b3b3b] text-gray-100 p-2.5 border border-gray-600 rounded-md focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-colors" required><option disabled>Select a reason</option><option>Routine Checkup</option><option>Consultation</option><option>Follow-up</option><option>Medication Refill</option><option>Test Results Review</option><option>Injury Consultation</option><option>Mental Health Concern</option><option>Headache</option><option>Chest Pain</option><option>Other</option></select></div></div> <div class="flex flex-col sm:flex-row justify-end gap-3 mt-8 pt-6 border-t border-gray-700"><button type="button" class="w-full sm:w-auto bg-gray-600 hover:bg-gray-500 text-white font-semibold py-2.5 px-5 rounded-lg transition duration-150 ease-in-out focus:outline-none focus:ring-2 focus:ring-gray-400">Cancel</button> <button type="submit" class="w-full sm:w-auto bg-green-500 hover:bg-green-600 text-white font-semibold py-2.5 px-5 rounded-lg transition duration-150 ease-in-out disabled:opacity-60 disabled:cursor-not-allowed focus:outline-none focus:ring-2 focus:ring-green-400"><!></button></div></form></div></div>'),Sa=f('<h1 class="text-2xl font-bold ml-6"> </h1> <div class="p-6 grid grid-cols-1 lg:grid-cols-2 gap-6"><div class="bg-[#2c2c2c] rounded-2xl p-4 shadow-md flex flex-col items-center justify-center"><h2 class="text-xl font-semibold mb-2">Doctors Taking Care of You</h2> <!></div> <div class="bg-[#2c2c2c] rounded-2xl p-4 shadow-md flex items-center justify-center"><div class="text-center"><h2 class="text-xl font-semibold mb-2">Next Appointment</h2> <!></div></div> <div class="bg-[#2c2c2c] rounded-xl shadow-lg w-full p-5 flex flex-col items-center justify-center"><span class="text-2xl font-semibold text-white mb-2">My Bills (Pending)</span> <div class="w-full h-40 overflow-y-auto"><table class="table table-sm w-full text-white"><thead><tr><th>Description</th><th>Amount</th><th>Status</th></tr></thead><tbody><!><!></tbody></table> <div class="flex items-center justify-center mt-2"><a href="/dashboard/patient/listbill" class="text-lg underline text-green-400">View All</a></div></div></div> <div class="bg-[#2c2c2c] rounded-xl shadow-lg w-full p-5 flex flex-col items-center justify-center"><span class="text-2xl font-semibold text-white mb-2">My Appointments (Pending)</span> <div class="w-full h-40 overflow-y-auto"><table class="table table-sm w-full text-white"><thead><tr><th>Date</th><th>Time</th><th>Doctor</th><th>Reason</th><th>Status</th></tr></thead><tbody><!><!></tbody></table></div> <a href="/dashboard/patient/sidebar/appointments" class="text-lg underline text-green-400 mt-2">View All</a></div></div> <div class="flex justify-center"><button class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-6 rounded-lg shadow-lg transition-all duration-150 ease-in-out transform hover:scale-105"><span class="mr-2">ðŸ“…</span> Book Appointment</button></div> <!>',1);function Fa(it,Y){Be(Y,!1);const R=m(),J=Ve("loggedInPatient");let q="",b="",S=m(null),H=m(!1),nt=m([]),lt=m([]),tt=m([]),et=m(null),j=m(!1),at=m([]),N=m([]),h=m(""),P=m(""),O=m(""),L=m(""),$=m(""),Q=m(""),K=m("success"),ge=new Date().toISOString().split("T")[0];async function dt(e){if(b=e.id||q,b)try{const a=oa(C,"users",b),l=await ra(a);if(l.exists()){const c=l.data();n(S,{name:c.name||"",surname:c.surname||""})}}catch(a){console.error("Error fetching patient data:",a)}Gt()}J&&typeof J.subscribe=="function"&&(ct=J.subscribe(dt)),ea(async()=>{const e=sa();e.currentUser?(q=e.currentUser.uid,b=q,await dt({id:q})):ia(e,async a=>{a&&(q=a.uid,b=a.uid,await dt({id:a.uid}))}),Gt()}),aa(()=>{ct&&ct(),ut&&ut(),pt&&pt(),vt&&vt(),ft&&ft(),mt&&mt()});function Gt(){if(!b)return;const e=z(M(C,"bills"),G("patientId","==",b));mt=Z(e,u=>{n(lt,u.docs.map(v=>({id:v.id,...v.data()})))});const a=z(M(C,"appointments"),G("patientId","==",b));ut=Z(a,u=>{const v=new Set;u.docs.forEach(d=>{const w=d.data().doctor;w&&v.add(w)}),n(nt,Array.from(v))});const l=z(M(C,"prescriptions"),G("patientId","==",b));pt=Z(l,u=>{u.docs.map(v=>({id:v.id,...v.data()}))});const c=z(M(C,"labTests"),G("patientId","==",b));vt=Z(c,u=>{u.docs.map(v=>({id:v.id,...v.data()}))});const y=z(M(C,"appointments"),G("patientId","==",b));ft=Z(y,u=>{n(tt,u.docs.map(d=>({id:d.id,...d.data()})));const v=t(tt).filter(d=>d.date&&d.status==="Pending").map(d=>({...d,dateObj:d.date.toDate?d.date.toDate():new Date(d.date)})).filter(d=>d.dateObj>=new Date).sort((d,w)=>d.dateObj.getTime()-w.dateObj.getTime());if(v.length){const d=v[0].dateObj.getTime()-new Date().getTime();n(et,Math.ceil(d/(1e3*60*60*24)))}else n(et,null)})}async function xe(){if(!t(P)||!t(O)||!t(L)||!t($)||!t(h)){n(Q,"Please fill in all required fields."),n(K,"error");return}try{const e=t(N).find(y=>y.id===t(P));if(!e)throw new Error("Selected doctor not found");const a={patientId:b,patientName:t(S)?`${t(S).name} ${t(S).surname}`:"",doctorId:e.id,doctor:`${e.name} ${e.surname}`,doctorSpecialty:e.specialty,date:t(O),time:t(L),reason:t($),status:"Pending",createdAt:be()},c={amount:500,appointmentId:(await _e(M(C,"appointments"),a)).id,createdAt:be(),description:`Appointment with Dr. ${e.name} ${e.surname}`,patientId:b,patientName:t(S)?`${t(S).name} ${t(S).surname}`:"",status:"pending",type:"appointment"};await _e(M(C,"bills"),c),n(Q,"Appointment booked successfully!"),n(K,"success"),setTimeout(()=>{n(H,!1),he()},2e3)}catch(e){console.error("Error booking appointment:",e),n(Q,`Failed to book appointment: ${e.message}`),n(K,"error")}}function he(){n(h,""),n(P,""),n(O,""),n(L,""),n($,""),n(Q,"")}async function ye(){n(j,!0);try{const e=z(M(C,"users"),G("role","==","Doctor")),a=await na(e);n(N,a.docs.map(l=>{const c=l.data();return{id:l.id,name:c.name||"",surname:c.surname||"",specialty:c.specialty||"General Practice"}})),n(at,Array.from(new Set(t(N).map(l=>l.specialty).filter(l=>l&&l.trim()!==""))).sort((l,c)=>l.localeCompare(c)))}catch(e){console.error("Error fetching doctors:",e),n(Q,"Failed to load doctors list"),n(K,"error")}finally{n(j,!1)}}let ct,ut,pt,vt,ft,mt;ze(()=>(t(P),t(O),t(L),t($),t(h),t(j)),()=>{n(R,!t(P)||!t(O)||!t(L)||!t($)||!t(h)||t(j))}),Ge(),ta();var Yt=Sa(),bt=Ut(Yt),we=s(bt);r(bt);var _t=o(bt,2),gt=s(_t),De=o(s(gt),2);{var ke=e=>{var a=ca();X(a,5,()=>t(nt),Vt,(l,c)=>{var y=da(),u=s(y);r(y),D(()=>x(u,`Dr. ${t(c)??""}`)),p(l,y)}),r(a),p(e,a)},Ae=e=>{var a=ua();p(e,a)};A(De,e=>{t(nt).length?e(ke):e(Ae,!1)})}r(gt);var xt=o(gt,2),Jt=s(xt),Se=o(s(Jt),2);{var je=e=>{var a=pa(),l=s(a);r(a),D(()=>x(l,`${t(et)??""} days`)),p(e,a)},Pe=e=>{var a=va();p(e,a)};A(Se,e=>{t(et)!==null?e(je):e(Pe,!1)})}r(Jt),r(xt);var ht=o(xt,2),Kt=o(s(ht),2),Wt=s(Kt),Xt=o(s(Wt)),Zt=s(Xt);{var Te=e=>{var a=fa();p(e,a)};A(Zt,e=>{t(lt).filter(a=>a.status==="pending").length===0&&e(Te)})}var Ce=o(Zt);X(Ce,1,()=>t(lt).filter(e=>e.status==="pending").slice(0,5),Vt,(e,a)=>{var l=ma(),c=s(l),y=s(c,!0);r(c);var u=o(c),v=s(u);r(u);var d=o(u),w=s(d,!0);r(d),r(l),D(()=>{x(y,t(a).description||"-"),x(v,`â‚±${t(a).amount||"0"}`),x(w,t(a).status==="paid"?"âœ… Paid":"ðŸ”´ Pending")}),p(e,l)}),r(Xt),r(Wt),pe(2),r(Kt),r(ht);var te=o(ht,2),ee=o(s(te),2),ae=s(ee),oe=o(s(ae)),re=s(oe);{var Re=e=>{var a=ba();p(e,a)};A(re,e=>{t(tt).filter(a=>a.status==="Pending").length===0&&e(Re)})}var $e=o(re);X($e,1,()=>[...t(tt)].filter(e=>e.status==="Pending").slice(0,5),Vt,(e,a)=>{var l=_a(),c=s(l),y=s(c,!0);r(c);var u=o(c),v=s(u,!0);r(u);var d=o(u),w=s(d,!0);r(d);var E=o(d),U=s(E,!0);r(E);var B=o(E),wt=s(B,!0);r(B),r(l),D(Dt=>{x(y,Dt),x(v,t(a).time||"-"),x(w,t(a).doctor||"-"),x(U,t(a).reason||"-"),x(wt,t(a).status||"-")},[()=>t(a).date?typeof t(a).date=="string"?new Date(t(a).date).toLocaleDateString():t(a).date.toDate?t(a).date.toDate().toLocaleDateString():"-":"-"],ve),p(e,l)}),r(oe),r(ae),r(ee),pe(2),r(te),r(_t);var yt=o(_t,2),Ie=s(yt);r(yt);var Me=o(yt,2);{var qe=e=>{var a=Aa(),l=s(a),c=s(l),y=o(s(c),2);r(c);var u=o(c,2);{var v=i=>{var _=ga(),V=s(_,!0);r(_),D(()=>{Ke(_,1,`p-3 mb-4 rounded-md text-sm font-medium ${t(K)==="success"?"bg-green-600 text-white":"bg-red-600 text-white"}`),x(V,t(Q))}),p(i,_)};A(u,i=>{t(Q)&&i(v)})}var d=o(u,2),w=s(d),E=s(w),U=o(s(E),2);D(()=>{t(h),Bt(()=>{t(P),t(j),t(at)})});var B=s(U);B.value=B.__value="";var wt=o(B);{var Dt=i=>{var _=xa();p(i,_)},Ne=(i,_)=>{{var V=I=>{var g=ha();p(I,g)},Ft=I=>{var g=He(),T=Ut(g);X(T,1,()=>t(at),rt=>rt,(rt,st)=>{var k=ya(),W={},Ht=s(k,!0);r(k),D(()=>{W!==(W=t(st))&&(k.value=(k.__value=t(st))??""),x(Ht,t(st))}),p(rt,k)}),p(I,g)};A(i,I=>{t(at).length===0?I(V):I(Ft,!1)},_)}};A(wt,i=>{t(j)?i(Dt):i(Ne,!1)})}r(U),r(E);var kt=o(E,2),ot=o(s(kt),2);D(()=>{t(P),Bt(()=>{t(h),t(j),t(N)})});var At=s(ot);At.value=At.__value="";var Oe=o(At);{var Le=i=>{var _=ka(),V=Ut(_);X(V,1,()=>t(N).filter(g=>g.specialty===t(h)),g=>g.id,(g,T,rt,st)=>{var k=wa(),W={},Ht=s(k);r(k),D(()=>{W!==(W=t(T).id)&&(k.value=(k.__value=t(T).id)??""),x(Ht,`${t(T).name??""} ${t(T).surname??""}`)}),p(g,k)});var Ft=o(V,2);{var I=g=>{var T=Da();p(g,T)};A(Ft,g=>{t(N).filter(T=>T.specialty===t(h)).length===0&&g(I)})}p(i,_)};A(Oe,i=>{t(h)&&!t(j)&&i(Le)})}r(ot),r(kt);var St=o(kt,2),jt=s(St),Pt=o(s(jt),2);fe(Pt),Je(Pt,"min",ge),r(jt);var se=o(jt,2),ie=o(s(se),2);fe(ie),r(se),r(St);var ne=o(St,2),Tt=o(s(ne),2);D(()=>{t($),Bt(()=>{})});var Ct=s(Tt);Ct.value=Ct.__value="";var Rt=o(Ct);Rt.value=Rt.__value="Routine Checkup";var $t=o(Rt);$t.value=$t.__value="Consultation";var It=o($t);It.value=It.__value="Follow-up";var Mt=o(It);Mt.value=Mt.__value="Medication Refill";var qt=o(Mt);qt.value=qt.__value="Test Results Review";var Nt=o(qt);Nt.value=Nt.__value="Injury Consultation";var Ot=o(Nt);Ot.value=Ot.__value="Mental Health Concern";var Lt=o(Ot);Lt.value=Lt.__value="Headache";var Qt=o(Lt);Qt.value=Qt.__value="Chest Pain";var le=o(Qt);le.value=le.__value="Other",r(Tt),r(ne),r(w);var de=o(w,2),ce=s(de),Et=o(ce,2),Qe=s(Et);{var Ee=i=>{var _=ue("Confirm Appointment");p(i,_)},Fe=i=>{var _=ue("Confirm Appointment");p(i,_)};A(Qe,i=>{t(R)&&!t(j)?i(Ee):i(Fe,!1)})}r(Et),r(de),r(d),r(l),r(a),D(i=>{ot.disabled=i,Et.disabled=t(R)},[()=>!t(h)||t(j)||t(N).filter(i=>i.specialty===t(h)).length===0],ve),F("click",y,()=>n(H,!1)),zt(U,()=>t(h),i=>n(h,i)),F("change",U,()=>{n(P,"")}),zt(ot,()=>t(P),i=>n(P,i)),me(Pt,()=>t(O),i=>n(O,i)),me(ie,()=>t(L),i=>n(L,i)),zt(Tt,()=>t($),i=>n($,i)),F("click",ce,()=>n(H,!1)),F("submit",d,We(xe)),F("click",l,Xe(function(i){la.call(this,Y,i)})),F("click",a,Ze(()=>n(H,!1))),p(e,a)};A(Me,e=>{t(H)&&e(qe)})}D(()=>x(we,`Hello, ${t(S)?`${t(S).name} ${t(S).surname}`:"Patient"}!`)),F("click",Ie,()=>{n(H,!0),ye()}),p(it,Yt),Ye()}export{Fa as component};
